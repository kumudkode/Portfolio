<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <title>Activity Calendar | Kumud Ranjan</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon/favicon.ico" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assets/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="assets/favicon/favicon-16x16.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="assets/favicon/apple-touch-icon.png"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@300;400;500;600&family=Space+Mono&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="stylesheet" href="assets/styles.css" />
    <style>
      :root {
        --bg: #fafafa;
        --card-bg: #ffffff;
        --border: #e5e7eb;
        --text: #1f2937;
        --text-light: #6b7280;
        --accent: #10b981;
        --accent-light: #d1fae5;
        --shadow: rgba(0, 0, 0, 0.05);
      }

      [data-theme="dark"] {
        --bg: #0f172a;
        --card-bg: #1e293b;
        --border: #334155;
        --text: #f1f5f9;
        --text-light: #94a3b8;
        --accent: #10b981;
        --accent-light: #064e3b;
        --shadow: rgba(0, 0, 0, 0.3);
      }

      body {
        background: var(--bg);
        color: var(--text);
      }

      .card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        box-shadow: 0 1px 3px var(--shadow);
      }

      .calendar-day {
        aspect-ratio: 1;
        border: 1px solid var(--border);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.75rem;
        position: relative;
        background: var(--card-bg);
      }

      .calendar-day:hover {
        transform: scale(1.15);
        border-color: var(--accent);
        box-shadow: 0 4px 12px var(--shadow);
        z-index: 10;
      }

      .calendar-day.has-activity-1 {
        background: #d1fae5;
        border-color: #a7f3d0;
      }

      .calendar-day.has-activity-2 {
        background: #6ee7b7;
        border-color: #34d399;
      }

      .calendar-day.has-activity-3 {
        background: #10b981;
        color: white;
        border-color: #059669;
      }

      [data-theme="dark"] .calendar-day.has-activity-1 {
        background: #064e3b;
        border-color: #065f46;
      }

      [data-theme="dark"] .calendar-day.has-activity-2 {
        background: #047857;
        border-color: #059669;
      }

      [data-theme="dark"] .calendar-day.has-activity-3 {
        background: #10b981;
        border-color: #34d399;
      }

      .calendar-day.today {
        border: 2px solid var(--accent);
        font-weight: bold;
        box-shadow: 0 0 0 3px var(--accent-light);
      }

      .calendar-day.selected {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }

      .activity-dot {
        position: absolute;
        bottom: 2px;
        left: 50%;
        transform: translateX(-50%);
        width: 4px;
        height: 4px;
        background: var(--accent);
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: translateX(-50%) scale(1);
        }
        50% {
          opacity: 0.5;
          transform: translateX(-50%) scale(1.2);
        }
      }

      .progress-ring {
        transform: rotate(-90deg);
      }

      .progress-ring-circle {
        transition: stroke-dashoffset 0.5s ease;
      }

      .stat-card {
        background: linear-gradient(135deg, var(--accent) 0%, #059669 100%);
        color: white;
        border: none;
      }

      .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        backdrop-filter: blur(8px);
        animation: fadeIn 0.3s ease;
      }

      .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 2rem;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        animation: slideUp 0.4s ease;
        box-shadow: 0 20px 60px var(--shadow);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          transform: translateY(30px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      #day-notes {
        color: var(--text);
        background: var(--card-bg);
        caret-color: var(--accent);
        border-color: var(--border);
      }

      #day-notes:focus {
        border-color: var(--accent);
        outline: none;
        box-shadow: 0 0 0 3px var(--accent-light);
      }

      #day-notes::placeholder {
        color: var(--text-light);
      }

      .checklist-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem;
        border-bottom: 1px solid var(--border);
        transition: background 0.2s ease;
      }

      .checklist-item:hover {
        background: var(--accent-light);
      }

      .checklist-item input[type="text"] {
        color: var(--text);
        background: transparent;
      }

      .note-card {
        animation: fadeInUp 0.3s ease forwards;
        opacity: 0;
      }

      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .tooltip {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-8px);
        background: var(--text);
        color: var(--bg);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 0.7rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s;
        z-index: 100;
      }

      .calendar-day:hover .tooltip {
        opacity: 1;
      }

      /* Mobile Responsive - Touch Friendly */
      @media (max-width: 768px) {
        /* Hide tooltips on touch - use tap instead */
        .tooltip {
          display: none;
        }

        /* Larger calendar days for touch */
        .calendar-day {
          min-width: 38px;
          min-height: 38px;
          font-size: 0.65rem;
          -webkit-tap-highlight-color: rgba(16, 185, 129, 0.3);
          touch-action: manipulation;
        }

        .calendar-day:active {
          transform: scale(0.95);
          transition: transform 0.1s ease;
        }

        /* Better modal on mobile */
        .modal-content {
          width: 95%;
          padding: 1.5rem;
          max-height: 85vh;
          border-radius: 16px;
        }

        /* Touch-friendly buttons */
        button {
          min-height: 44px;
          min-width: 44px;
          -webkit-tap-highlight-color: rgba(16, 185, 129, 0.2);
          touch-action: manipulation;
        }

        button:active {
          transform: scale(0.95);
          transition: transform 0.1s ease;
        }

        /* Better checklist items for touch */
        .checklist-item {
          min-height: 48px;
          padding: 0.875rem;
        }

        /* Stat cards - stack on mobile */
        .stat-card {
          min-height: 80px;
        }

        /* Input fields - prevent iOS zoom */
        input,
        textarea,
        select {
          font-size: 16px !important;
        }

        /* Better note card touch */
        .note-card {
          -webkit-tap-highlight-color: transparent;
        }

        .note-card:active {
          transform: scale(0.98);
          transition: transform 0.1s ease;
        }
      }

      /* Small phones */
      @media (max-width: 480px) {
        .calendar-day {
          min-width: 32px;
          min-height: 32px;
          font-size: 0.6rem;
        }

        .modal-content {
          padding: 1rem;
        }
      }

      /* Touch device detection */
      @media (hover: none) and (pointer: coarse) {
        .calendar-day:hover {
          transform: none;
          box-shadow: none;
        }

        .calendar-day:active {
          transform: scale(1.1);
          border-color: var(--accent);
          box-shadow: 0 4px 12px var(--shadow);
        }

        .checklist-item:hover {
          background: transparent;
        }

        .checklist-item:active {
          background: var(--accent-light);
        }
      }
    </style>
  </head>
  <body>
    <!-- Audio Elements -->
    <audio id="click-sound" src="assets/audio/click.mp3" preload="auto"></audio>
    <audio
      id="project-sound"
      src="assets/audio/project.mp3"
      preload="auto"
    ></audio>
    <audio
      id="effect-sound"
      src="assets/audio/effect.mp3"
      preload="auto"
    ></audio>
    <audio id="moon-sound" src="assets/audio/moon.mp3" preload="auto"></audio>
    <audio
      id="notification-sound"
      src="assets/audio/notification-1-reversed-317859.mp3"
      preload="auto"
    ></audio>
    <audio
      id="button-sound"
      src="assets/audio/button_10-190436.mp3"
      preload="auto"
    ></audio>
    <audio
      id="click2-sound"
      src="assets/audio/clicking-433009.mp3"
      preload="auto"
    ></audio>
    <audio id="clinn-sound" src="assets/audio/clinn.mp3" preload="auto"></audio>

    <div class="noise-overlay" aria-hidden="true"></div>
    <div id="cursor-blob" aria-hidden="true"></div>
    <div id="cursor-ring" aria-hidden="true"></div>

    <!-- Navigation -->
    <nav
      class="fixed top-0 w-full px-4 sm:px-6 md:px-12 py-4 sm:py-5 flex justify-between items-center z-[100]"
      style="mix-blend-mode: difference; pointer-events: none"
    >
      <div class="flex items-center justify-between w-full">
        <a
          href="index.html"
          class="flex items-center gap-1 select-none cursor-pointer"
          style="pointer-events: auto"
        >
          <span
            class="text-white text-base sm:text-lg md:text-xl tracking-normal"
            style="font-family: 'Lora', serif"
            >Kumud</span
          >
          <span
            class="logo-word text-white text-base sm:text-lg md:text-xl tracking-normal"
            style="font-family: 'Lora', serif"
            >Kode</span
          >
        </a>
        <div
          class="flex items-center gap-0.5 sm:gap-1 md:gap-3"
          style="pointer-events: auto"
        >
          <div class="hidden md:flex items-center gap-4 md:gap-6">
            <a
              href="index.html"
              class="text-white text-xs sm:text-sm tracking-wide hover:opacity-60 transition-all duration-300"
              style="font-family: 'Lora', serif"
              >Home</a
            >
            <a
              href="services.html"
              class="text-white text-xs sm:text-sm tracking-wide hover:opacity-60 transition-all duration-300"
              style="font-family: 'Lora', serif"
              >Services</a
            >
            <a
              href="projects.html"
              class="text-white text-xs sm:text-sm tracking-wide hover:opacity-60 transition-all duration-300"
              style="font-family: 'Lora', serif"
              >Projects</a
            >
            <a
              href="activity.html"
              class="text-white text-xs sm:text-sm tracking-wide opacity-100 border-b border-white"
              style="font-family: 'Lora', serif"
              aria-current="page"
              >Activity</a
            >
          </div>
          <button
            class="theme-toggle flex-shrink-0"
            onclick="toggleTheme(); if(typeof playSound === 'function') playSound('moon-sound');"
            aria-label="Toggle theme"
            type="button"
          >
            <svg
              class="sun-icon"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="12" cy="12" r="5" />
              <line
                x1="12"
                y1="1"
                x2="12"
                y2="3"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="12"
                y1="21"
                x2="12"
                y2="23"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="4.22"
                y1="4.22"
                x2="5.64"
                y2="5.64"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="18.36"
                y1="18.36"
                x2="19.78"
                y2="19.78"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="1"
                y1="12"
                x2="3"
                y2="12"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="21"
                y1="12"
                x2="23"
                y2="12"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="4.22"
                y1="19.78"
                x2="5.64"
                y2="18.36"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="18.36"
                y1="5.64"
                x2="19.78"
                y2="4.22"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
            <svg
              class="moon-icon"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
          </button>
          <button
            class="sound-toggle flex-shrink-0"
            onclick="toggleSound()"
            aria-label="Toggle sound"
            type="button"
          >
            <svg
              class="sound-on"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M11 5L6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 010 7.07M19.07 4.93a10 10 0 010 14.14"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                fill="none"
              />
            </svg>
            <svg
              class="sound-off"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M11 5L6 9H2v6h4l5 4V5zM23 9l-6 6M17 9l6 6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                fill="none"
              />
            </svg>
          </button>
          <button
            class="mobile-nav-toggle md:hidden text-white"
            type="button"
            aria-label="Toggle navigation menu"
            aria-controls="mobile-menu"
            aria-expanded="false"
            style="pointer-events: auto"
          >
            <span class="sr-only">Toggle menu</span>
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
          </button>
        </div>
      </div>
    </nav>

    <div
      id="mobile-overlay"
      class="mobile-menu-overlay md:hidden"
      hidden
      aria-hidden="true"
    ></div>
    <div
      id="mobile-menu"
      class="mobile-menu md:hidden"
      aria-hidden="true"
      role="dialog"
      aria-modal="true"
      aria-label="Mobile navigation"
    >
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-1 select-none">
          <span
            class="text-white text-base sm:text-lg tracking-normal"
            style="font-family: 'Lora', serif"
            >Kumud</span
          >
          <span
            class="logo-word text-base sm:text-lg tracking-normal"
            style="font-family: 'Lora', serif"
            aria-hidden="true"
            >Kode</span
          >
        </div>
        <button
          class="mobile-nav-toggle text-white"
          type="button"
          aria-label="Close navigation menu"
          aria-controls="mobile-menu"
          aria-expanded="false"
        >
          <span class="sr-only">Close menu</span>
          <span class="line"></span>
          <span class="line"></span>
          <span class="line"></span>
        </button>
      </div>
      <div class="menu-meta mono">Navigate</div>
      <div class="flex flex-col" role="menu">
        <a href="index.html" role="menuitem">Home</a>
        <a href="services.html" role="menuitem">Services</a>
        <a href="projects.html" role="menuitem">Projects</a>
        <a href="activity.html" role="menuitem" aria-current="page">Activity</a>
      </div>
    </div>

    <main class="min-h-screen pt-24 px-4 sm:px-6 md:px-16 pb-16">
      <div class="max-w-[1400px] mx-auto">
        <!-- Header -->
        <div class="mb-12">
          <h1 class="text-4xl sm:text-6xl md:text-7xl serif italic mb-4">
            Activity Tracker
          </h1>
          <p class="text-base opacity-60 mb-8">
            Track your daily progress and maintain streaks.
          </p>

          <!-- Stats Grid -->
          <div class="grid grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="card rounded-2xl p-4">
              <div
                class="text-3xl font-bold text-green-600"
                id="total-activities"
              >
                0
              </div>
              <div class="mono text-xs opacity-50 mt-1">Active Days</div>
            </div>
            <div class="card rounded-2xl p-4">
              <div class="text-3xl font-bold text-green-600" id="total-days">
                31
              </div>
              <div class="mono text-xs opacity-50 mt-1">Days in Month</div>
            </div>
            <div class="card rounded-2xl p-4">
              <div class="text-3xl font-bold text-green-600" id="days-left">
                0
              </div>
              <div class="mono text-xs opacity-50 mt-1">Days Left</div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Calendar Section -->
          <div>
            <h2 class="text-2xl font-semibold mb-4">Calendar</h2>
            <div
              class="card rounded-2xl p-6 hover:shadow-lg transition-all duration-300"
            >
              <div class="flex items-center justify-between mb-4">
                <button
                  id="prev-month"
                  class="mono text-sm hover:text-green-600 transition-colors px-3 py-1 rounded-lg hover:bg-green-50"
                >
                  ‚Üê Prev
                </button>
                <h3 class="text-lg font-semibold" id="current-month"></h3>
                <button
                  id="next-month"
                  class="mono text-sm hover:text-green-600 transition-colors px-3 py-1 rounded-lg hover:bg-green-50"
                >
                  Next ‚Üí
                </button>
              </div>
              <div class="grid grid-cols-7 gap-1 mb-2">
                <div class="text-center mono text-xs opacity-50">S</div>
                <div class="text-center mono text-xs opacity-50">M</div>
                <div class="text-center mono text-xs opacity-50">T</div>
                <div class="text-center mono text-xs opacity-50">W</div>
                <div class="text-center mono text-xs opacity-50">T</div>
                <div class="text-center mono text-xs opacity-50">F</div>
                <div class="text-center mono text-xs opacity-50">S</div>
              </div>
              <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
              <div
                class="flex items-center justify-between mt-4 pt-4 border-t"
                style="border-color: var(--border)"
              >
                <div class="flex gap-3 text-xs">
                  <div class="flex items-center gap-2">
                    <div
                      class="w-4 h-4 rounded"
                      style="background: #d1fae5; border: 1px solid #a7f3d0"
                    ></div>
                    <span class="opacity-60">Low</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <div
                      class="w-4 h-4 rounded"
                      style="background: #6ee7b7; border: 1px solid #34d399"
                    ></div>
                    <span class="opacity-60">Med</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <div
                      class="w-4 h-4 rounded"
                      style="background: #10b981; border: 1px solid #059669"
                    ></div>
                    <span class="opacity-60">High</span>
                  </div>
                </div>
                <div class="mono text-xs opacity-50">üü¢ = Active Day</div>
              </div>
            </div>
          </div>

          <!-- Notes Section -->
          <div>
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-2xl font-semibold">Daily Notes & Tasks</h2>
              <button
                id="view-all-notes"
                class="mono text-xs text-green-600 hover:underline transition-all hover:translate-x-1"
              >
                View All Notes ‚Üí
              </button>
            </div>
            <div
              class="card rounded-2xl p-6 hover:shadow-lg transition-all duration-300"
            >
              <div class="mb-4">
                <div class="text-lg font-semibold mb-1" id="selected-date">
                  Select a date
                </div>
                <div class="h-1 w-12 bg-green-600 rounded-full"></div>
              </div>
              <div class="mb-6">
                <label class="mono text-xs opacity-50 mb-2 block">Notes</label>
                <textarea
                  id="day-notes"
                  class="w-full p-3 border rounded-lg resize-none transition-all"
                  rows="6"
                  placeholder="Add your notes..."
                ></textarea>
              </div>
              <div class="mb-6">
                <label class="mono text-xs opacity-50 mb-2 block"
                  >Checklist</label
                >
                <div
                  id="checklist-container"
                  class="mb-2 border rounded-lg overflow-hidden"
                  style="border-color: var(--border)"
                ></div>
                <button
                  id="add-task"
                  class="mono text-xs text-green-600 hover:underline mt-2 transition-all hover:translate-x-1"
                >
                  + Add Task
                </button>
              </div>
              <div class="flex gap-2">
                <button
                  id="save-activity"
                  class="flex-1 mono text-sm py-3 px-6 bg-green-600 text-white rounded-full hover:bg-green-700 transition-all duration-500 hover:scale-105"
                >
                  üíæ Save
                </button>
                <button
                  id="delete-activity"
                  class="mono text-sm py-3 px-6 border border-red-500 text-red-500 rounded-full hover:bg-red-500 hover:text-white transition-all duration-500 hover:scale-105"
                >
                  üóëÔ∏è Delete
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- All Notes Modal -->
        <div id="notes-modal" class="modal">
          <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-2xl font-semibold">All Notes</h3>
              <button
                id="close-notes-modal"
                class="text-2xl hover:text-orange-600 transition-colors"
              >
                &times;
              </button>
            </div>
            <div
              id="all-notes-list"
              class="space-y-4 max-h-96 overflow-y-auto"
            ></div>
          </div>
        </div>
      </div>
    </main>

    <script src="assets/theme.js"></script>
    <script>
      // Sound toggle
      let soundEnabled = true;
      function toggleSound() {
        soundEnabled = !soundEnabled;
        localStorage.setItem("soundEnabled", soundEnabled);
        const toggle = document.querySelector(".sound-toggle");
        if (soundEnabled) {
          toggle.classList.remove("muted");
        } else {
          toggle.classList.add("muted");
        }
        playSound("click-sound");
      }

      // Mobile menu toggle
      const mobileMenu = document.getElementById("mobile-menu");
      const mobileOverlay = document.getElementById("mobile-overlay");
      const mobileToggleButtons = document.querySelectorAll(
        ".mobile-nav-toggle"
      );

      // Ensure hamburger is visible on load
      window.addEventListener("DOMContentLoaded", () => {
        if (window.innerWidth < 768) {
          mobileToggleButtons.forEach((btn) => {
            btn.style.display = "inline-flex";
          });
        }
      });

      const setMobileMenuState = (isOpen) => {
        if (!mobileMenu || !mobileOverlay) return;

        mobileMenu.classList.toggle("open", isOpen);
        mobileMenu.setAttribute("aria-hidden", isOpen ? "false" : "true");
        mobileOverlay.classList.toggle("active", isOpen);
        mobileOverlay.hidden = !isOpen;

        document.body.classList.toggle("overflow-hidden", isOpen);
        document.documentElement.classList.toggle("overflow-hidden", isOpen);

        mobileToggleButtons.forEach((btn) =>
          btn.setAttribute("aria-expanded", isOpen ? "true" : "false")
        );
      };

      mobileToggleButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const isOpen = mobileMenu?.classList.contains("open");
          setMobileMenuState(!isOpen);
        });
      });

      mobileOverlay?.addEventListener("click", () => setMobileMenuState(false));

      mobileMenu?.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", () => setMobileMenuState(false));
      });

      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          setMobileMenuState(false);
        }
      });

      window.addEventListener("resize", () => {
        if (window.innerWidth >= 768) {
          setMobileMenuState(false);
        }
      });

      // Audio functions
      const playSound = (id) => {
        if (!soundEnabled) return;
        const sound = document.getElementById(id);
        if (sound) {
          sound.currentTime = 0;
          sound.play().catch(() => {});
        }
      };

      // Load sound preference
      window.addEventListener("load", () => {
        const saved = localStorage.getItem("soundEnabled");
        if (saved !== null) {
          soundEnabled = saved === "true";
          const toggle = document.querySelector(".sound-toggle");
          if (!soundEnabled && toggle) toggle.classList.add("muted");
        }
      });

      // Click sound for general clickable elements
      document.addEventListener(
        "click",
        (e) => {
          const target = e.target.closest('a, [role="menuitem"]');
          if (
            target &&
            !target.closest(".calendar-day") &&
            !target.closest("#save-activity") &&
            !target.closest("#delete-activity") &&
            !target.closest("#add-task") &&
            !target.closest("#view-all-notes") &&
            !target.closest("#prev-month") &&
            !target.closest("#next-month") &&
            !target.closest(".theme-toggle") &&
            !target.closest(".sound-toggle")
          ) {
            const href = target.href || "";

            // Services/Projects navigation
            if (
              href.includes("services.html") ||
              href.includes("projects.html")
            ) {
              e.preventDefault();
              playSound("project-sound");
              setTimeout(() => {
                if (href) window.location.href = href;
              }, 500);
            } else {
              playSound("click-sound");
            }
          }
        },
        true
      );

      let currentDate = new Date();
      let selectedDate = null;
      let activities = JSON.parse(localStorage.getItem("activities") || "{}");

      // Render calendar
      function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const today = new Date();

        document.getElementById("current-month").textContent =
          currentDate.toLocaleDateString("en-US", {
            month: "short",
            year: "numeric",
          });

        const grid = document.getElementById("calendar-grid");
        grid.innerHTML = "";

        // Empty cells
        for (let i = 0; i < firstDay; i++) {
          grid.innerHTML += "<div></div>";
        }

        // Days
        for (let day = 1; day <= daysInMonth; day++) {
          const dateStr = `${year}-${String(month + 1).padStart(
            2,
            "0"
          )}-${String(day).padStart(2, "0")}`;
          const isToday =
            today.getDate() === day &&
            today.getMonth() === month &&
            today.getFullYear() === year;
          const activity = activities[dateStr];
          const isSelected = selectedDate === dateStr;

          // Calculate activity level (1-3 based on notes length and tasks)
          let activityLevel = 0;
          if (activity) {
            const notesLength = (activity.notes || "").length;
            const tasksCount = (activity.tasks || []).length;
            const score = notesLength + tasksCount * 50;
            if (score > 0) activityLevel = 1;
            if (score > 100) activityLevel = 2;
            if (score > 200) activityLevel = 3;
          }

          const dayEl = document.createElement("div");
          dayEl.className = `calendar-day flex items-center justify-center ${
            isToday ? "today" : ""
          } ${activityLevel > 0 ? `has-activity-${activityLevel}` : ""} ${
            isSelected ? "selected" : ""
          }`;
          dayEl.innerHTML = `
            ${day}
            ${activityLevel > 0 ? '<div class="activity-dot"></div>' : ""}
            <div class="tooltip">${
              activityLevel > 0
                ? `${activityLevel} contribution${activityLevel > 1 ? "s" : ""}`
                : "No activity"
            }</div>
          `;
          dayEl.onclick = () => {
            playSound("click2-sound");
            selectDate(dateStr);
          };
          grid.appendChild(dayEl);
        }

        updateStats();
      }

      // Update stats
      function updateStats() {
        const totalActivities = Object.keys(activities).length;
        document.getElementById("total-activities").textContent =
          totalActivities;

        // Total days in current month
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        document.getElementById("total-days").textContent = daysInMonth;

        // Days left in current month
        const today = new Date();
        const currentDay = today.getDate();
        const daysLeft = daysInMonth - currentDay;
        document.getElementById("days-left").textContent = daysLeft;
      }

      // Select date
      function selectDate(dateStr) {
        selectedDate = dateStr;
        const activity = activities[dateStr] || { notes: "", tasks: [] };

        document.getElementById("selected-date").textContent = new Date(
          dateStr
        ).toLocaleDateString("en-US", {
          weekday: "long",
          month: "short",
          day: "numeric",
          year: "numeric",
        });
        document.getElementById("day-notes").value = activity.notes || "";

        renderChecklist(activity.tasks || []);
        renderCalendar();
      }

      // Render checklist
      function renderChecklist(tasks) {
        const container = document.getElementById("checklist-container");
        if (tasks.length === 0) {
          container.innerHTML =
            '<div class="text-center py-4 text-sm opacity-50">No tasks yet</div>';
          return;
        }
        container.innerHTML = tasks
          .map(
            (task, i) => `
          <div class="checklist-item">
            <input type="checkbox" ${
              task.done ? "checked" : ""
            } onchange="toggleTask(${i})" class="w-4 h-4 cursor-pointer" />
            <input type="text" value="${
              task.text
            }" onchange="updateTask(${i}, this.value)" class="flex-1 bg-transparent border-none outline-none ${
              task.done ? "line-through opacity-50" : ""
            }" />
            <button onclick="deleteTask(${i})" class="text-red-500 hover:text-red-700 hover:scale-125 transition-all">√ó</button>
          </div>
        `
          )
          .join("");
      }

      // Task functions
      window.toggleTask = (i) => {
        playSound("clinn-sound");
        const activity = activities[selectedDate] || { notes: "", tasks: [] };
        activity.tasks[i].done = !activity.tasks[i].done;
        activities[selectedDate] = activity;
        localStorage.setItem("activities", JSON.stringify(activities));
      };

      window.updateTask = (i, text) => {
        const activity = activities[selectedDate] || { notes: "", tasks: [] };
        activity.tasks[i].text = text;
        activities[selectedDate] = activity;
        localStorage.setItem("activities", JSON.stringify(activities));
      };

      window.deleteTask = (i) => {
        playSound("click-sound");
        const activity = activities[selectedDate] || { notes: "", tasks: [] };
        activity.tasks.splice(i, 1);
        activities[selectedDate] = activity;
        localStorage.setItem("activities", JSON.stringify(activities));
        renderChecklist(activity.tasks);
      };

      document.getElementById("add-task").onclick = () => {
        playSound("button-sound");
        const activity = activities[selectedDate] || { notes: "", tasks: [] };
        activity.tasks.push({ text: "New task", done: false });
        activities[selectedDate] = activity;
        renderChecklist(activity.tasks);
      };

      // Save activity
      document.getElementById("save-activity").onclick = () => {
        if (!selectedDate) return;
        playSound("notification-sound");
        const notes = document.getElementById("day-notes").value;
        const activity = activities[selectedDate] || { tasks: [] };
        activity.notes = notes;
        activities[selectedDate] = activity;
        localStorage.setItem("activities", JSON.stringify(activities));
        renderCalendar();
      };

      // Delete activity
      document.getElementById("delete-activity").onclick = () => {
        if (!selectedDate) return;
        playSound("click-sound");
        if (confirm("Delete all notes and tasks for this day?")) {
          delete activities[selectedDate];
          localStorage.setItem("activities", JSON.stringify(activities));
          document.getElementById("day-notes").value = "";
          renderChecklist([]);
          renderCalendar();
        }
      };

      // View all notes
      document.getElementById("view-all-notes").onclick = () => {
        playSound("effect-sound");
        const notesList = document.getElementById("all-notes-list");
        const notesArray = Object.entries(activities)
          .filter(([date, data]) => data.notes)
          .sort((a, b) => new Date(b[0]) - new Date(a[0]));

        if (notesArray.length === 0) {
          notesList.innerHTML =
            '<p class="text-center opacity-50 py-8">No notes yet. Start writing! ‚úçÔ∏è</p>';
        } else {
          notesList.innerHTML = notesArray
            .map(
              ([date, data], i) => `
            <div class="note-card card rounded-lg p-4 hover:shadow-md transition-all hover:scale-[1.02]" style="animation-delay: ${
              i * 0.1
            }s; transform: translateY(20px);">
              <div class="flex items-center justify-between mb-2">
                <div class="font-semibold flex items-center gap-2">
                  <span class="text-green-600">üìÖ</span>
                  ${new Date(date).toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                    year: "numeric",
                  })}
                </div>
                <button onclick="deleteNote('${date}')" class="text-red-500 hover:text-red-700 text-xl hover:scale-125 transition-all">√ó</button>
              </div>
              <p class="text-sm opacity-70 leading-relaxed">${data.notes}</p>
              ${
                data.tasks && data.tasks.length > 0
                  ? `<div class="mt-2 text-xs opacity-50 flex items-center gap-1"><span>‚úì</span> ${data.tasks.length} task(s)</div>`
                  : ""
              }
            </div>
          `
            )
            .join("");
        }
        document.getElementById("notes-modal").classList.add("active");
      };

      // Delete note from modal
      window.deleteNote = (date) => {
        playSound("click-sound");
        if (confirm("Delete this note?")) {
          delete activities[date];
          localStorage.setItem("activities", JSON.stringify(activities));
          document.getElementById("view-all-notes").click();
          renderCalendar();
        }
      };

      // Close notes modal
      document.getElementById("close-notes-modal").onclick = () => {
        playSound("click-sound");
        document.getElementById("notes-modal").classList.remove("active");
      };

      // Month navigation
      document.getElementById("prev-month").onclick = () => {
        playSound("button-sound");
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
      };

      document.getElementById("next-month").onclick = () => {
        playSound("button-sound");
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
      };

      // Initialize
      renderCalendar();
      selectDate(new Date().toISOString().split("T")[0]);

      // Cursor
      const blob = document.getElementById("cursor-blob");
      const ring = document.getElementById("cursor-ring");
      let mouseX = 0,
        mouseY = 0,
        blobX = 0,
        blobY = 0,
        ringX = 0,
        ringY = 0;

      document.addEventListener("mousemove", (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
      });

      function animateCursor() {
        blobX += (mouseX - blobX) * 0.8;
        blobY += (mouseY - blobY) * 0.8;
        ringX += (mouseX - ringX) * 0.15;
        ringY += (mouseY - ringY) * 0.15;
        blob.style.transform = `translate3d(${blobX - 4}px, ${blobY - 4}px, 0)`;
        ring.style.transform = `translate3d(${ringX - 17.5}px, ${
          ringY - 17.5
        }px, 0)`;
        requestAnimationFrame(animateCursor);
      }
      if (window.innerWidth > 768) animateCursor();
      // Visitor Tracking
      (async function trackVisitor() {
        try {
          // Anti-bot checks
          if (navigator.webdriver || window.Cypress || window.__nightmare)
            return;
          if (
            !/Mozilla|Chrome|Safari|Firefox|Edge|Opera/i.test(
              navigator.userAgent
            )
          )
            return;

          // Honeypot delay
          await new Promise((r) => setTimeout(r, 1500));

          const SCRIPT_URL =
            "https://script.google.com/macros/s/AKfycbyXbUb4VdC1WCGeClF3WqRS93ElLfX9H25OEO2YSQlgfmIsKSRsVIdzuhpSxuDuwuiOgA/exec";

          // Generate secure token
          const timestamp = Date.now();
          const SECRET_SALT = "kk_portfolio_2026";
          const rawToken = `${timestamp}_${SECRET_SALT}_${navigator.userAgent.slice(
            0,
            20
          )}`;
          const token = btoa(rawToken).replace(/=/g, "");

          // Session tracking
          const sessionKey = "portfolio_session";
          const visitorKey = "portfolio_visitor_id";
          let sessionId = sessionStorage.getItem(sessionKey);
          if (!sessionId) {
            sessionId =
              "sess_" +
              Date.now() +
              "_" +
              Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem(sessionKey, sessionId);
          }

          // Returning visitor tracking
          let visitorId = localStorage.getItem(visitorKey);
          let isNewVisitor = !visitorId;
          if (!visitorId) {
            visitorId =
              "vis_" +
              Date.now() +
              "_" +
              Math.random().toString(36).substr(2, 9);
            localStorage.setItem(visitorKey, visitorId);
          }
          let visitCount = parseInt(
            localStorage.getItem("portfolio_visit_count") || "0"
          );

          // Rate limiting
          const lastRequest = parseInt(
            sessionStorage.getItem("last_track") || "0"
          );
          if (Date.now() - lastRequest < 5000) return;
          sessionStorage.setItem("last_track", Date.now());

          // UTM parameters
          const urlParams = new URLSearchParams(window.location.search);
          const utm = {
            source: urlParams.get("utm_source") || "",
            medium: urlParams.get("utm_medium") || "",
            campaign: urlParams.get("utm_campaign") || "",
            content: urlParams.get("utm_content") || "",
          };

          function getSource() {
            if (utm.source) return utm.source;
            const ref = document.referrer.toLowerCase();
            if (!ref) return "Direct";
            if (ref.includes("linkedin")) return "LinkedIn";
            if (ref.includes("instagram")) return "Instagram";
            if (ref.includes("twitter") || ref.includes("x.com"))
              return "Twitter/X";
            if (ref.includes("facebook")) return "Facebook";
            if (ref.includes("github")) return "GitHub";
            if (ref.includes("google")) return "Google";
            if (ref.includes("youtube")) return "YouTube";
            try {
              return new URL(ref).hostname;
            } catch (e) {
              return "Other";
            }
          }

          function getBrowser() {
            const ua = navigator.userAgent;
            if (ua.includes("Firefox")) return "Firefox";
            if (ua.includes("Edg")) return "Edge";
            if (ua.includes("Chrome")) return "Chrome";
            if (ua.includes("Safari")) return "Safari";
            if (ua.includes("Opera") || ua.includes("OPR")) return "Opera";
            return "Other";
          }

          const response = await fetch("https://ipapi.co/json/");
          const data = await response.json();

          // Only send if not already tracked this page in session
          const pageKey = "visited_activity";
          if (!sessionStorage.getItem(pageKey)) {
            sessionStorage.setItem(pageKey, "true");

            fetch(SCRIPT_URL, {
              method: "POST",
              mode: "no-cors",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                _token: token,
                _timestamp: timestamp,
                _origin: window.location.hostname,
                sessionId: sessionId,
                visitorId: visitorId,
                isNewVisitor: isNewVisitor,
                visitCount: visitCount,
                ip: data.ip || "Unknown",
                country: data.country_name || "Unknown",
                region: data.region || "Unknown",
                city: data.city || "Unknown",
                postal: data.postal || "Unknown",
                latitude: data.latitude || null,
                longitude: data.longitude || null,
                timezone: data.timezone || "Unknown",
                isp: data.org || "Unknown",
                page: "activity",
                device: /Mobile|Android|iPhone/i.test(navigator.userAgent)
                  ? "Mobile"
                  : "Desktop",
                browser: getBrowser(),
                screenRes: `${screen.width}x${screen.height}`,
                language: navigator.language || "Unknown",
                source: getSource(),
                utmMedium: utm.medium,
                utmCampaign: utm.campaign,
                utmContent: utm.content,
              }),
            });
          }
        } catch (e) {}
      })();
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <title>Services | Kumud Ranjan</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/favicon.png" />
    <link rel="apple-touch-icon" href="assets/favicon.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@300;400;500;600&family=Space+Mono&family=Syne:wght@400;500;600;700;800&family=Outfit:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lenis@1.0.45/dist/lenis.min.js"></script>
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <!-- Audio Elements -->
    <audio id="click-sound" src="assets/audio/click.mp3" preload="auto"></audio>
    <audio
      id="connect-sound"
      src="assets/audio/connect.mp3"
      preload="auto"
    ></audio>
    <audio
      id="project-sound"
      src="assets/audio/project.mp3"
      preload="auto"
    ></audio>
    <audio
      id="effect-sound"
      src="assets/audio/effect.mp3"
      preload="auto"
    ></audio>
    <audio id="moon-sound" src="assets/audio/moon.mp3" preload="auto"></audio>

    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="noise-overlay" aria-hidden="true"></div>
    <div id="cursor-blob" aria-hidden="true"></div>
    <div id="cursor-ring" aria-hidden="true"></div>

    <!-- Navigation -->
    <nav
      class="fixed top-0 w-full px-4 sm:px-6 md:px-12 py-4 sm:py-5 flex justify-between items-center z-[100]"
      role="navigation"
      style="mix-blend-mode: difference; pointer-events: none"
    >
      <a
        href="index.html"
        class="flex items-center gap-1 select-none cursor-pointer"
        style="pointer-events: auto"
      >
        <span
          class="text-white text-base sm:text-lg md:text-xl tracking-normal"
          style="font-family: 'Lora', serif"
          >Kumud</span
        >
        <span
          id="cycle-logo"
          class="logo-word text-white text-base sm:text-lg md:text-xl tracking-normal"
          style="font-family: 'Lora', serif"
          >Kode</span
        >
      </a>
      <div
        class="flex items-center gap-3 sm:gap-6 md:gap-8"
        role="menubar"
        style="pointer-events: auto"
      >
        <a
          href="index.html#about"
          class="text-white text-xs sm:text-sm tracking-wide hover:opacity-60 transition-all duration-300 hidden sm:inline"
          style="font-family: 'Lora', serif"
          >About</a
        >
        <a
          href="services.html"
          class="text-white text-xs sm:text-sm tracking-wide opacity-100 border-b border-white"
          style="font-family: 'Lora', serif"
          aria-current="page"
          >Services</a
        >
        <a
          href="projects.html"
          class="text-white text-xs sm:text-sm tracking-wide hover:opacity-60 transition-all duration-300"
          style="font-family: 'Lora', serif"
          >Projects</a
        >
        <a
          href="index.html#contact"
          class="text-white text-xs sm:text-sm tracking-wide hover:opacity-60 transition-all duration-300"
          style="font-family: 'Lora', serif"
          >Contact</a
        >
        <button
          class="theme-toggle flex-shrink-0"
          onclick="toggleTheme()"
          aria-label="Toggle theme"
          type="button"
        >
          <svg
            class="sun-icon"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="12" cy="12" r="5" />
            <line
              x1="12"
              y1="1"
              x2="12"
              y2="3"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <line
              x1="12"
              y1="21"
              x2="12"
              y2="23"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <line
              x1="4.22"
              y1="4.22"
              x2="5.64"
              y2="5.64"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <line
              x1="18.36"
              y1="18.36"
              x2="19.78"
              y2="19.78"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <line
              x1="1"
              y1="12"
              x2="3"
              y2="12"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <line
              x1="21"
              y1="12"
              x2="23"
              y2="12"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <line
              x1="4.22"
              y1="19.78"
              x2="5.64"
              y2="18.36"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <line
              x1="18.36"
              y1="5.64"
              x2="19.78"
              y2="4.22"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
          <svg
            class="moon-icon"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
        </button>
        <button
          class="sound-toggle flex-shrink-0"
          onclick="toggleSound()"
          aria-label="Toggle sound"
          type="button"
        >
          <svg
            class="sound-on"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M11 5L6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 010 7.07M19.07 4.93a10 10 0 010 14.14"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              fill="none"
            />
          </svg>
          <svg
            class="sound-off"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M11 5L6 9H2v6h4l5 4V5zM23 9l-6 6M17 9l6 6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              fill="none"
            />
          </svg>
        </button>
      </div>
    </nav>

    <main id="main-content" role="main" tabindex="-1">
      <!-- Hero Section -->
      <section
        class="min-h-[50vh] flex flex-col justify-center px-4 sm:px-6 md:px-16 pt-24 sm:pt-28 pb-8 sm:pb-12 relative overflow-hidden"
      >
        <div class="max-w-[1400px] w-full mx-auto">
          <div class="mono opacity-50 mb-4 text-sm reveal-text">
            Services I Offer
          </div>
          <h1 class="text-4xl sm:text-6xl md:text-7xl serif mb-4 hero-reveal">
            What I <span class="italic" style="color: #ff4d00">Build</span>
          </h1>
          <p class="text-base sm:text-lg opacity-60 max-w-2xl reveal-text">
            From simple WordPress sites to complex full-stack applications.
            Let's build something amazing together.
          </p>
        </div>
      </section>

      <!-- Divider -->
      <div class="px-6 md:px-16">
        <div class="divider scroll-line"></div>
      </div>

      <!-- Services Grid -->
      <section class="py-16 sm:py-24 px-4 sm:px-6 md:px-16">
        <div class="max-w-[1400px] mx-auto">
          <div
            id="services-grid"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8"
          >
            <!-- Services loaded dynamically -->
            <div class="col-span-full text-center py-12 opacity-50">
              <p class="mono text-sm">Loading services...</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Testimonials Section -->
      <section
        class="py-16 sm:py-24 px-4 sm:px-6 md:px-16 bg-white/30"
        aria-label="Client testimonials"
      >
        <div class="max-w-[1400px] mx-auto">
          <div class="text-center mb-12">
            <div class="mono opacity-50 mb-4 text-sm">(04) Client Feedback</div>
            <h2
              class="text-3xl sm:text-5xl md:text-6xl serif italic reveal-text"
            >
              What Users Say
            </h2>
          </div>
          <div
            id="testimonials-grid"
            class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8"
          >
            <div class="col-span-full text-center py-12 opacity-50">
              <p class="mono text-sm">Loading testimonials...</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Divider -->
      <div class="px-6 md:px-16 py-4">
        <div class="max-w-[1400px] mx-auto">
          <div class="h-[1px] bg-gradient-to-r from-transparent via-orange-500/50 to-transparent"></div>
        </div>
      </div>

      <!-- CTA Section -->
      <section class="py-16 sm:py-24 px-4 sm:px-6 md:px-16">
        <div class="max-w-[1400px] mx-auto text-center">
          <div class="mono opacity-50 mb-4 text-sm reveal-text">Let's Build Together</div>
          <h2
            class="text-3xl sm:text-5xl md:text-6xl serif italic mb-6 reveal-text"
          >
            Want to work with me?
          </h2>
          <p class="text-base sm:text-lg opacity-60 mb-4 reveal-text max-w-2xl mx-auto">
            I'm always excited to collaborate on new projects. Whether you need a complete web application, 
            a landing page, or technical consultation ‚Äî let's discuss how I can help bring your ideas to life.
          </p>
          <p class="text-sm opacity-40 mb-8 reveal-text">
            Response time: Usually within 24 hours ‚ö°
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center items-center reveal-text">
            <a
              href="index.html#contact"
              class="mono text-sm py-3 px-8 bg-orange-600 text-white rounded-full hover:bg-orange-700 transition-all duration-500 inline-block hover:scale-105"
            >
              Start a Conversation ‚Üí
            </a>
            <a
              href="mailto:connect.kumud@gmail.com"
              class="mono text-sm py-3 px-8 border border-black/20 rounded-full hover:border-orange-600 hover:text-orange-600 transition-all duration-500 inline-block"
            >
              connect.kumud@gmail.com
            </a>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer
        id="contact"
        class="py-16 sm:py-20 px-4 sm:px-6 md:px-16 border-t border-black/10"
      >
        <div class="max-w-[1400px] mx-auto">
          <div
            class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 text-left"
          >
            <div>
              <div class="mono opacity-30 mb-4 text-orange-500 text-xs">
                Quick Links
              </div>
              <nav class="flex flex-col gap-2">
                <a
                  href="index.html"
                  class="serif text-lg hover:text-orange-600 transition-colors"
                  >Home</a
                >
                <a
                  href="index.html#about"
                  class="serif text-lg hover:text-orange-600 transition-colors"
                  >About</a
                >
                <a
                  href="projects.html"
                  class="serif text-lg hover:text-orange-600 transition-colors"
                  >Projects</a
                >
              </nav>
            </div>
            <div>
              <div class="mono opacity-30 mb-4 text-orange-500 text-xs">
                Connect
              </div>
              <nav class="flex flex-col gap-2">
                <a
                  href="https://linkedin.com/in/kumudkode"
                  target="_blank"
                  class="serif text-lg hover:text-orange-600 transition-colors"
                  >LinkedIn</a
                >
                <a
                  href="https://github.com/kumudkode"
                  target="_blank"
                  class="serif text-lg hover:text-orange-600 transition-colors"
                  >GitHub</a
                >
                <a
                  href="mailto:raj94971@gmail.com"
                  class="serif text-lg hover:text-orange-600 transition-colors"
                  >Email</a
                >
              </nav>
            </div>
            <div class="sm:col-span-2 md:col-span-1">
              <div class="mono opacity-30 mb-4 text-orange-500 text-xs">
                Location
              </div>
              <p class="serif text-lg">Noida, UP, India</p>
              <div class="mono opacity-20 mt-8 text-xs flex items-center gap-4">
                <span>¬© 2025 KUMUD RANJAN</span>
                <a href="privacy.html" class="hover:opacity-70 transition-opacity">Privacy</a>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </main>

    <script src="assets/theme.js"></script>
    <script>
      // Sound toggle
      let soundEnabled = true;
      function toggleSound() {
        soundEnabled = !soundEnabled;
        localStorage.setItem("soundEnabled", soundEnabled);
        const toggle = document.querySelector(".sound-toggle");
        if (soundEnabled) {
          toggle.classList.remove("muted");
        } else {
          toggle.classList.add("muted");
        }
      }

      // Audio functions
      const playSound = (id) => {
        if (!soundEnabled) return;
        const sound = document.getElementById(id);
        if (sound) {
          sound.currentTime = 0;
          sound.play().catch(() => {});
        }
      };

      window.addEventListener("load", () => {
        const saved = localStorage.getItem("soundEnabled");
        if (saved !== null) {
          soundEnabled = saved === "true";
          const toggle = document.querySelector(".sound-toggle");
          if (!soundEnabled && toggle) toggle.classList.add("muted");
        }
      });

      // Click sound for all clickable elements
      document.addEventListener(
        "click",
        (e) => {
          const target = e.target.closest(
            'a, button, [role="menuitem"], .service-card, .skill-tag'
          );
          if (target) {
            const text = target.textContent.trim();
            const href = target.href || "";

            // Moon sound for theme toggle
            if (target.classList.contains("theme-toggle")) {
              playSound("moon-sound");
            }
            // Sound toggle click
            else if (target.classList.contains("sound-toggle")) {
              playSound("click-sound");
            }
            // Project sound for project links
            else if (
              href.includes("projects.html") ||
              text.includes("Project")
            ) {
              e.preventDefault();
              playSound("project-sound");
              setTimeout(() => {
                if (href) window.location.href = href;
              }, 500);
            }
            // Connect sound for contact links
            else if (
              href.includes("#contact") ||
              href.includes("mailto:") ||
              text.includes("Get Quote") ||
              text.includes("Get in Touch")
            ) {
              playSound("connect-sound");
            }
            // Service card interaction
            else if (target.classList.contains("service-card")) {
              playSound("effect-sound");
            }
            // Default click sound
            else {
              playSound("click-sound");
            }
          }
        },
        true
      );

      // Smooth scroll
      const lenis = new Lenis();
      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }
      requestAnimationFrame(raf);

      gsap.registerPlugin(ScrollTrigger);

      // Hero animations
      window.addEventListener("load", () => {
        gsap.from(".hero-reveal", {
          opacity: 0,
          y: 30,
          duration: 1,
          ease: "expo.out",
        });
      });

      // Logo cycling
      const logoCycle = document.getElementById("cycle-logo");
      const words = ["KODE", "CODE", "DEV", "SYSTEM"];
      let wordIndex = 0;
      function cycleText() {
        gsap.to(logoCycle, {
          opacity: 0,
          y: -5,
          duration: 0.3,
          onComplete: () => {
            wordIndex = (wordIndex + 1) % words.length;
            logoCycle.innerText = words[wordIndex];
            gsap.to(logoCycle, { opacity: 1, y: 0, duration: 0.3 });
          },
        });
      }
      setInterval(cycleText, 3000);

      // Cursor
      const blob = document.getElementById("cursor-blob");
      const ring = document.getElementById("cursor-ring");
      let mouseX = 0,
        mouseY = 0,
        blobX = 0,
        blobY = 0,
        ringX = 0,
        ringY = 0;

      document.addEventListener("mousemove", (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
      });

      function animateCursor() {
        blobX += (mouseX - blobX) * 0.8;
        blobY += (mouseY - blobY) * 0.8;
        ringX += (mouseX - ringX) * 0.15;
        ringY += (mouseY - ringY) * 0.15;
        blob.style.transform = `translate3d(${blobX - 4}px, ${blobY - 4}px, 0)`;
        ring.style.transform = `translate3d(${ringX - 17.5}px, ${
          ringY - 17.5
        }px, 0)`;
        requestAnimationFrame(animateCursor);
      }
      if (window.innerWidth > 768) animateCursor();

      // Reveal animations
      gsap.utils.toArray(".reveal-text").forEach((text) => {
        gsap.from(text, {
          scrollTrigger: { trigger: text, start: "top 90%" },
          opacity: 0,
          y: 20,
          duration: 1,
          ease: "power3.out",
        });
      });

      gsap.utils.toArray(".scroll-line").forEach((line) => {
        gsap.from(line, {
          scrollTrigger: { trigger: line, start: "top 95%" },
          scaleX: 0,
          duration: 1.5,
          ease: "expo.out",
        });
      });

      // Magnetic effect
      const magnets = document.querySelectorAll(".magnetic-wrap");
      magnets.forEach((magnet) => {
        magnet.addEventListener("mousemove", (e) => {
          const rect = magnet.getBoundingClientRect();
          const x = (e.clientX - rect.left - rect.width / 2) * 0.3;
          const y = (e.clientY - rect.top - rect.height / 2) * 0.3;
          gsap.to(magnet.querySelector("a"), { x, y, duration: 0.3 });
        });
        magnet.addEventListener("mouseleave", () => {
          gsap.to(magnet.querySelector("a"), {
            x: 0,
            y: 0,
            duration: 0.5,
            ease: "elastic.out(1, 0.3)",
          });
        });
      });

      // Load services
      fetch("data/services.json")
        .then((res) => res.json())
        .then((services) => {
          const grid = document.getElementById("services-grid");
          grid.innerHTML = services
            .map(
              (service) => `
            <div class="service-card bg-white/40 border border-black/10 rounded-2xl p-6 sm:p-8 hover:shadow-xl hover:scale-[1.02] transition-all duration-500 reveal-text relative overflow-hidden group">
              <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-2">
                  <div class="w-14 h-14 rounded-full bg-gradient-to-br from-orange-100 to-orange-200 flex items-center justify-center group-hover:scale-110 transition-transform">
                    <span class="text-3xl">${getIcon(service.icon)}</span>
                  </div>
                  ${
                    service.trending
                      ? '<div class="bg-gradient-to-r from-orange-500 to-pink-500 text-white text-xs px-2 py-1 rounded-full mono">Trending 2026</div>'
                      : ""
                  }
                </div>
                <span class="mono text-xs opacity-50">${
                  service.deliveryTime
                }</span>
              </div>
              <h3 class="text-xl sm:text-2xl font-semibold mb-3 group-hover:text-orange-600 transition-colors">${
                service.title
              }</h3>
              <p class="text-sm opacity-70 mb-4 leading-relaxed">${
                service.description
              }</p>
              <div class="flex flex-wrap gap-2 mb-4">
                ${service.features
                  .map((f) => `<span class="skill-tag text-xs">${f}</span>`)
                  .join("")}
              </div>
              <div class="flex items-center justify-end pt-4 border-t border-black/5">
                <a href="index.html#contact" class="mono text-xs hover:text-orange-600 transition-colors flex items-center gap-1 group/link">
                  Get Quote 
                  <svg class="w-3 h-3 group-hover/link:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </a>
              </div>
            </div>
          `
            )
            .join("");

          // Animate service cards
          gsap.utils.toArray(".service-card").forEach((card, i) => {
            gsap.from(card, {
              scrollTrigger: { trigger: card, start: "top 90%" },
              opacity: 0,
              y: 30,
              duration: 0.8,
              delay: i * 0.1,
              ease: "power3.out",
            });
          });
        });

      function getIcon(type) {
        const icons = {
          design: "üé®",
          redesign: "‚ú®",
          wordpress: "üåê",
          landing: "üöÄ",
          fullstack: "‚ö°",
          ecommerce: "üõí",
          dashboard: "üìä",
          api: "üîå",
          ai: "ü§ñ",
          realtime: "‚ö°",
          integration: "üîó",
          pwa: "üì±",
          maintenance: "üîß",
          automation: "ü§ñ",
        };
        return icons[type] || "üíª";
      }

      // Random accent color
      (function () {
        const palettes = [
          ["#ff4d00", "#ff6b2b"],
          ["#00d4aa", "#00e5bb"],
          ["#8b5cf6", "#a78bfa"],
          ["#f59e0b", "#fbbf24"],
          ["#ef4444", "#f87171"],
          ["#06b6d4", "#22d3ee"],
        ];
        const randomPalette =
          palettes[Math.floor(Math.random() * palettes.length)];
        document.documentElement.style.setProperty(
          "--accent",
          randomPalette[0]
        );
        const logo = document.getElementById("cycle-logo");
        if (logo) logo.style.color = randomPalette[0];
      })();

      // Load testimonials
      fetch("data/testimonials.json")
        .then((res) => res.json())
        .then((testimonials) => {
          const grid = document.getElementById("testimonials-grid");
          grid.innerHTML = testimonials
            .map(
              (t) => `
            <div class="bg-white/40 border border-black/10 rounded-2xl p-6 sm:p-8 reveal-text">
              <div class="flex items-center gap-4 mb-4">
                <div class="w-12 h-12 rounded-full bg-orange-600 text-white flex items-center justify-center font-bold">
                  ${t.avatar}
                </div>
                <div>
                  <div class="font-semibold">${t.name}</div>
                  <div class="text-sm opacity-60">${t.role}</div>
                </div>
              </div>
              <div class="flex gap-1 mb-3">
                ${Array(t.rating).fill("‚≠ê").join("")}
              </div>
              <p class="text-sm opacity-70 mb-3 leading-relaxed">${t.text}</p>
              <div class="mono text-xs opacity-50">Project: ${t.project}</div>
            </div>
          `
            )
            .join("");

          gsap.utils.toArray("#testimonials-grid > div").forEach((card, i) => {
            gsap.from(card, {
              scrollTrigger: { trigger: card, start: "top 90%" },
              opacity: 0,
              y: 30,
              duration: 0.8,
              delay: i * 0.1,
            });
          });
        });

      // Visitor Tracking
      (async function trackVisitor() {
        try {
          // Anti-bot checks
          if (navigator.webdriver || window.Cypress || window.__nightmare) return;
          if (!/Mozilla|Chrome|Safari|Firefox|Edge|Opera/i.test(navigator.userAgent)) return;
          
          // Honeypot delay
          await new Promise(r => setTimeout(r, 1500));
          
          const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyXbUb4VdC1WCGeClF3WqRS93ElLfX9H25OEO2YSQlgfmIsKSRsVIdzuhpSxuDuwuiOgA/exec';
          
          // Generate secure token
          const timestamp = Date.now();
          const SECRET_SALT = 'kk_portfolio_2026';
          const rawToken = `${timestamp}_${SECRET_SALT}_${navigator.userAgent.slice(0,20)}`;
          const token = btoa(rawToken).replace(/=/g, '');

          // Session tracking
          const sessionKey = 'portfolio_session';
          const visitorKey = 'portfolio_visitor_id';
          let sessionId = sessionStorage.getItem(sessionKey);
          if (!sessionId) {
            sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem(sessionKey, sessionId);
          }
          
          // Returning visitor tracking
          let visitorId = localStorage.getItem(visitorKey);
          let isNewVisitor = !visitorId;
          if (!visitorId) {
            visitorId = 'vis_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem(visitorKey, visitorId);
          }
          let visitCount = parseInt(localStorage.getItem('portfolio_visit_count') || '0');
          
          // Rate limiting
          const lastRequest = parseInt(sessionStorage.getItem('last_track') || '0');
          if (Date.now() - lastRequest < 5000) return;
          sessionStorage.setItem('last_track', Date.now());
          
          // UTM parameters
          const urlParams = new URLSearchParams(window.location.search);
          const utm = {
            source: urlParams.get('utm_source') || '',
            medium: urlParams.get('utm_medium') || '',
            campaign: urlParams.get('utm_campaign') || '',
            content: urlParams.get('utm_content') || ''
          };

          function getSource() {
            if (utm.source) return utm.source;
            const ref = document.referrer.toLowerCase();
            if (!ref) return 'Direct';
            if (ref.includes('linkedin')) return 'LinkedIn';
            if (ref.includes('instagram')) return 'Instagram';
            if (ref.includes('twitter') || ref.includes('x.com')) return 'Twitter/X';
            if (ref.includes('facebook')) return 'Facebook';
            if (ref.includes('github')) return 'GitHub';
            if (ref.includes('google')) return 'Google';
            if (ref.includes('youtube')) return 'YouTube';
            try { return new URL(ref).hostname; } catch(e) { return 'Other'; }
          }
          
          function getBrowser() {
            const ua = navigator.userAgent;
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Edg')) return 'Edge';
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Safari')) return 'Safari';
            if (ua.includes('Opera') || ua.includes('OPR')) return 'Opera';
            return 'Other';
          }

          const response = await fetch('https://ipapi.co/json/');
          const data = await response.json();
          
          // Only send if not already tracked this page in session
          const pageKey = 'visited_services';
          if (!sessionStorage.getItem(pageKey)) {
            sessionStorage.setItem(pageKey, 'true');
            
            fetch(SCRIPT_URL, {
              method: 'POST',
              mode: 'no-cors',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                _token: token,
                _timestamp: timestamp,
                _origin: window.location.hostname,
                sessionId: sessionId,
                visitorId: visitorId,
                isNewVisitor: isNewVisitor,
                visitCount: visitCount,
                ip: data.ip || 'Unknown',
                country: data.country_name || 'Unknown',
                region: data.region || 'Unknown',
                city: data.city || 'Unknown',
                postal: data.postal || 'Unknown',
                latitude: data.latitude || null,
                longitude: data.longitude || null,
                timezone: data.timezone || 'Unknown',
                isp: data.org || 'Unknown',
                page: 'services',
                device: /Mobile|Android|iPhone/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop',
                browser: getBrowser(),
                screenRes: `${screen.width}x${screen.height}`,
                language: navigator.language || 'Unknown',
                source: getSource(),
                utmMedium: utm.medium,
                utmCampaign: utm.campaign,
                utmContent: utm.content
              })
            });
          }
        } catch (error) {}
      })();
    </script>
  </body>
</html>
